{% extends 'game/base.html.twig' %}

{% block title %}En attente{% endblock %}

{% block body %}
    <header>
        <div>
            <h1>En attente du départ</h1>
            <p class="hint">Équipe {{ team_code }}</p>
        </div>
        <span class="badge">Lobby</span>
    </header>

    <div class="card stack">
        {% if game_status == 'waiting' %}
            <div class="status">La partie est ouverte. Préparez-vous !</div>
            <p class="hint">Quand le signal est donné, vous serez redirigé automatiquement.</p>
        {% elseif game_status == 'offline' %}
            <div class="status closed">La partie est temporairement fermée.</div>
            <p class="hint">Patientez jusqu'à la relance par l'animateur.</p>
        {% else %}
            <div class="status">La partie démarre...</div>
        {% endif %}
        <a class="btn btn-outline" href="{{ path('game_step', { step: current_step }) }}">Accéder à l'étape {{ current_step }}</a>
    </div>

    <div class="card">
        <h2>Conseil</h2>
        <p class="hint">Gardez ce téléphone avec vous : il affiche votre progression tout au long du jeu.</p>
    </div>
    <script>
        const pollStatus = () => {
            fetch("{{ path('game_status') }}", { credentials: "same-origin" })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'active') {
                        window.location.href = "{{ path('game_step', { step: current_step }) }}";
                    }
                })
                .catch(() => {});
        };

        setInterval(pollStatus, 3000);
    </script>
{% endblock %}