{% extends '../game/base_desk.html.twig' %}

{% block title %}Accueil jeu{% endblock %}

{% block body %}
    <header>
        <div class="first_title">
            {# <h1>{{ escape_game.name }}</h1> #}
            <h1>L'escape</h1>
            {% if escape_game %}
                <p class="hint2">des</p>
            {% else %}
                <p class="hint">Aucun escape enregistré.</p>
            {% endif %}
        </div>
        <span class="badge2">ça va commencer....</span>
    </header>

    <div class="card stack soli">
        <div class="status">Rejoignez la partie via l'adresse suivante :</div>
        {#<div class="lien_jeu">{{ join_url }}</div>
         <a class="btn" href="{{ join_url }}" target="_blank" rel="noopener">Ouvrir la page join</a> #}
        <div class="btn">{{ join_url }}</div>
    </div>
{#
    <div class="info">
        <h2>ça va bientôt commencer...</h2>
        <p class="hint">...</p>
    </div>
#}
    <script>
        (function () {
            const scoreboardUrl = "{{ path('game_scoreboard') }}";
            const statusUrl = "{{ path('game_scoreboard_data') }}";

            const checkStatus = () => {
                fetch(statusUrl, { headers: { 'Accept': 'application/json' } })
                    .then((response) => response.ok ? response.json() : null)
                    .then((payload) => {
                        if (payload && payload.status === 'active') {
                            window.location.href = scoreboardUrl;
                        }
                    })
                    .catch(() => {});
            };

            checkStatus();
            setInterval(checkStatus, 4000);
        })();
    </script>
{% endblock %}